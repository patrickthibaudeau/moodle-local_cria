{"version":3,"file":"bot_form.min.js","sources":["../src/bot_form.js"],"sourcesContent":["import $ from 'jquery';\nimport notification from 'core/notification';\nimport ajax from 'core/ajax';\nimport ModalFactory from 'core/modal_factory';\nimport select2 from 'local_cria/select2';\n\nexport const init = () => {\n    // Set child_bots as select2\n    $('#id_child_bots').select2({\n        'theme': 'bootstrap4',\n    });\n    set_tone_button();\n    set_length_button();\n    get_bot_type_message();\n    get_model_max_tokens();\n    set_tone_parameters();\n    set_length_parameters();\n};\n\n/**\n * Delete a content\n */\nfunction get_bot_type_message() {\n\n    $(\"#id_bot_type\").off();\n    $(\"#id_bot_type\").on('change', function () {\n        var id = $(this).val();\n        var get_system_message = ajax.call([{\n            methodname: 'cria_get_bot_type_message',\n            args: {\n                id: id\n            }\n        }]);\n\n        get_system_message[0].done(function (result) {\n            if ($('#id_bot_system_message').length) {\n                $('#id_bot_system_message').val('');\n                $('#id_bot_system_message').val(result.trim());\n            }\n\n            if ($('[name=\"bot_system_message\"]').length) {\n                $('[name=\"bot_system_message\"]').val('');\n                $('[name=\"bot_system_message\"]').val(result.trim());\n            }\n\n        }).fail(function () {\n            alert('An error has occurred. The record was not deleted');\n        });\n\n    });\n}\n\nfunction get_model_max_tokens() {\n\n    $(\"#id_model_id\").off();\n    $(\"#id_model_id\").on('change', function () {\n        var id = $(this).val();\n\n        if (id != '') {\n            var get_max_tokens = ajax.call([{\n                methodname: 'cria_get_model_max_tokens',\n                args: {\n                    id: id\n                }\n            }]);\n\n            get_max_tokens[0].done(function (result) {\n                // Add to bot_max_tokens\n                $('[name=\"bot_max_tokens\"]').val(result);\n                if ($('[name=\"max_tokens\"]').length) {\n                    $('[name=\"max_tokens\"]').val('');\n                    $('[name=\"max_tokens\"]').val(result);\n                }\n\n                // if .btn-short is active adjsut max_tokens\n                if ($('.btn-short').hasClass('active')) {\n                    $('[name=\"max_tokens\"]').val(result / 8);\n                }\n                // if .btn-medium is active adjsut max_tokens\n                if ($('.btn-medium').hasClass('active')) {\n                    $('[name=\"max_tokens\"]').val(result / 2);\n                }\n                // if .btn-long is active adjsut max_tokens\n                if ($('.btn-long').hasClass('active')) {\n                    $('[name=\"max_tokens\"]').val(result - 2000);\n                }\n\n            }).fail(function () {\n                alert('An error has occurred. The record was not deleted');\n            });\n            $('#cria-tone-buttons').show();\n        } else {\n            $('#cria-tone-buttons').hide();\n        }\n    });\n}\n\n/**\n * Set the tone button when page loads\n */\nfunction set_tone_button() {\n    let tone = $('[name=\"tone\"]').val();\n    switch (tone) {\n        case 'creative':\n            $('#tone-creative').addClass('active');\n            break;\n        case 'balanced':\n            $('#tone-balanced').addClass('active');\n            break;\n        case 'precise':\n            $('#tone-precise').addClass('active');\n            break;\n    }\n\n}\n\n/**\n * Set the length button when page loads\n */\nfunction set_length_button() {\n    let length = $('[name=\"response_length\"]').val();\n    switch (length) {\n        case 'short':\n            $('.btn-short').addClass('active');\n            break;\n        case 'medium':\n            $('.btn-medium').addClass('active');\n            break;\n        case 'long':\n            $('.btn-long').addClass('active');\n            break;\n    }\n}\n\n/**\n * Update the tone parameters\n */\nfunction set_tone_parameters() {\n    $('.btn-gpt-tone').off();\n    $('.btn-gpt-tone').on('click', function () {\n        // remove class active for all buttons with class .btn-gpt-tone\n        $('.btn-gpt-tone').removeClass('active');\n        // Add class active to this button\n        $(this).addClass('active');\n        // Get element id\n        let id = $(this).attr('id');\n        $('[name=\"tone\"]').val(id.replace('tone-', ''));\n        // Update id_temperature\n        $('[name=\"temperature\"]').val($(this).data('temperature'));\n        // Update id_top_p\n        $('[name=\"top_p\"]').val($(this).data('top_p'));\n        // pdate top_k\n        $('[name=\"top_k\"]').val($(this).data('top_k'));\n        // pdate min_relevance\n        $('[name=\"min_relevance\"]').val($(this).data('min_relevance'));\n    });\n}\n\n/**\n * Set length paramters\n */\nfunction set_length_parameters() {\n    let max_tokens = 0;\n    // Set button short\n    $('.btn-short').off();\n    $('.btn-short').on('click', function () {\n        max_tokens = $('[name=\"bot_max_tokens\"]').val();\n        $('[name=\"max_tokens\"]').val(max_tokens / 8);\n        $('.btn-medium').removeClass('active');\n        $('.btn-long').removeClass('active');\n        $(this).addClass('active');\n        $('[name=\"response_length\"]').val('short');\n    });\n    // Set button medium\n    $('.btn-medium').off();\n    $('.btn-medium').on('click', function () {\n        max_tokens = $('[name=\"bot_max_tokens\"]').val();\n        $('[name=\"max_tokens\"]').val(max_tokens / 2);\n        $('.btn-short').removeClass('active');\n        $('.btn-long').removeClass('active');\n        $(this).addClass('active');\n        $('[name=\"response_length\"]').val('medium');\n    });\n    // Set button long\n    $('.btn-long').off();\n    $('.btn-long').on('click', function () {\n        max_tokens = $('[name=\"bot_max_tokens\"]').val();\n        // reduce by 200 tokens to make sure all content can be used.\n        $('[name=\"max_tokens\"]').val(max_tokens - 2000);\n        $('.btn-short').removeClass('active');\n        $('.btn-medium').removeClass('active');\n        $(this).addClass('active');\n        $('[name=\"response_length\"]').val('long');\n    });\n}\n\n"],"names":["select2","val","addClass","set_tone_button","set_length_button","off","on","id","this","ajax","call","methodname","args","done","result","length","trim","fail","alert","hasClass","show","hide","removeClass","attr","replace","data","max_tokens","set_length_parameters"],"mappings":"8kBAMoB,yBAEd,kBAAkBA,QAAQ,OACf,kCA4FF,mBAAE,iBAAiBC,WAErB,+BACC,kBAAkBC,SAAS,oBAE5B,+BACC,kBAAkBA,SAAS,oBAE5B,8BACC,iBAAiBA,SAAS,WAnGpCC,sBA6Ga,mBAAE,4BAA4BF,WAElC,4BACC,cAAcC,SAAS,oBAExB,6BACC,eAAeA,SAAS,oBAEzB,2BACC,aAAaA,SAAS,WArHhCE,uBAYE,gBAAgBC,0BAChB,gBAAgBC,GAAG,UAAU,eACvBC,IAAK,mBAAEC,MAAMP,MACQQ,cAAKC,KAAK,CAAC,CAChCC,WAAY,4BACZC,KAAM,CACFL,GAAIA,OAIO,GAAGM,MAAK,SAAUC,SAC7B,mBAAE,0BAA0BC,6BAC1B,0BAA0Bd,IAAI,wBAC9B,0BAA0BA,IAAIa,OAAOE,UAGvC,mBAAE,+BAA+BD,6BAC/B,+BAA+Bd,IAAI,wBACnC,+BAA+BA,IAAIa,OAAOE,YAGjDC,MAAK,WACJC,MAAM,+EAQZ,gBAAgBb,0BAChB,gBAAgBC,GAAG,UAAU,eACvBC,IAAK,mBAAEC,MAAMP,MAEP,IAANM,IACqBE,cAAKC,KAAK,CAAC,CAC5BC,WAAY,4BACZC,KAAM,CACFL,GAAIA,OAIG,GAAGM,MAAK,SAAUC,4BAE3B,2BAA2Bb,IAAIa,SAC7B,mBAAE,uBAAuBC,6BACvB,uBAAuBd,IAAI,wBAC3B,uBAAuBA,IAAIa,UAI7B,mBAAE,cAAcK,SAAS,+BACvB,uBAAuBlB,IAAIa,OAAS,IAGtC,mBAAE,eAAeK,SAAS,+BACxB,uBAAuBlB,IAAIa,OAAS,IAGtC,mBAAE,aAAaK,SAAS,+BACtB,uBAAuBlB,IAAIa,OAAS,QAG3CG,MAAK,WACJC,MAAM,4EAER,sBAAsBE,4BAEtB,sBAAsBC,8BA8C9B,iBAAiBhB,0BACjB,iBAAiBC,GAAG,SAAS,+BAEzB,iBAAiBgB,YAAY,8BAE7Bd,MAAMN,SAAS,cAEbK,IAAK,mBAAEC,MAAMe,KAAK,0BACpB,iBAAiBtB,IAAIM,GAAGiB,QAAQ,QAAS,yBAEzC,wBAAwBvB,KAAI,mBAAEO,MAAMiB,KAAK,oCAEzC,kBAAkBxB,KAAI,mBAAEO,MAAMiB,KAAK,8BAEnC,kBAAkBxB,KAAI,mBAAEO,MAAMiB,KAAK,8BAEnC,0BAA0BxB,KAAI,mBAAEO,MAAMiB,KAAK,oCAQ7CC,WAAa,sBAEf,cAAcrB,0BACd,cAAcC,GAAG,SAAS,WACxBoB,YAAa,mBAAE,2BAA2BzB,0BACxC,uBAAuBA,IAAIyB,WAAa,uBACxC,eAAeJ,YAAY,8BAC3B,aAAaA,YAAY,8BACzBd,MAAMN,SAAS,8BACf,4BAA4BD,IAAI,gCAGpC,eAAeI,0BACf,eAAeC,GAAG,SAAS,WACzBoB,YAAa,mBAAE,2BAA2BzB,0BACxC,uBAAuBA,IAAIyB,WAAa,uBACxC,cAAcJ,YAAY,8BAC1B,aAAaA,YAAY,8BACzBd,MAAMN,SAAS,8BACf,4BAA4BD,IAAI,iCAGpC,aAAaI,0BACb,aAAaC,GAAG,SAAS,WACvBoB,YAAa,mBAAE,2BAA2BzB,0BAExC,uBAAuBA,IAAIyB,WAAa,yBACxC,cAAcJ,YAAY,8BAC1B,eAAeA,YAAY,8BAC3Bd,MAAMN,SAAS,8BACf,4BAA4BD,IAAI,WAhLtC0B"}