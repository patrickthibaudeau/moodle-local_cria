{"version":3,"file":"assign_users.min.js","sources":["../src/assign_users.js"],"sourcesContent":["import $ from 'jquery';\nimport ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport select2 from './select2';\n\nexport const init = () => {\n    initialize_modal();\n}\n\nfunction initialize_modal() {\n    $('.btn-assign-users').off();\n    $('.btn-assign-users').on('click', function () {\n        let role_id = $(this).data('roleid');\n        let bot_id = $(this).data('botid');\n        let role_name = $(this).data('rolename');\n        // Set modal title\n        $('#cria-modal-title').html('Assign Users to ' + role_name);\n        $('#roleid').val(role_id);\n        $('#botid').val(bot_id);\n        // Using ajax, add all users to assigned users list\n        get_assigned_users(role_id);\n        // Using ajax, get all users\n        get_all_users(role_id);\n        // Assign users\n        assign_users();\n        // Unassign users\n        unassign_users();\n        // Search assigned users on keyup\n        $('#cria-search-unassigned-user').on('keyup', function () {\n            let name = $(this).val();\n            if (name.length == 0) {\n                get_all_users(role_id);\n            }\n            if (name.length >= 3) {\n                get_all_users(role_id, name);\n            }\n        });\n        // Show modal\n        $(\"#assign-users-modal\").modal(\"show\");\n\n    });\n}\n\n/**\n * Get Assinged users\n */\nfunction get_assigned_users(role_id) {\n    $('#cria-assigned-users').empty();\n    var assigned_users = ajax.call([{\n        methodname: 'cria_get_assigned_users',\n        args: {\n            id: role_id\n        }\n    }]);\n\n    assigned_users[0].done(function (results) {\n        $.each(results, function (index, value) {\n            $('#cria-assigned-users').append($('<option>', {\n                value: value.id,\n                text: value.firstname + ' ' + value.lastname\n            }));\n        });\n    }).fail(function (error) {\n        console.log(error);\n        alert('An error has occurred.');\n    });\n}\n\n/**\n * Get all users\n */\nfunction get_all_users(role_id, name = '') {\n    $('#cria-unassigned-users').empty();\n    // Using ajax, get all users\n    var all_users = ajax.call([{\n        methodname: 'cria_get_users',\n        args: {\n            role_id: role_id,\n            id: -1,\n            name: name\n        }\n    }]);\n\n    all_users[0].done(function (all_users_results) {\n        $.each(all_users_results, function (index, value) {\n            $('#cria-unassigned-users').append($('<option>', {\n                value: value.id,\n                text: value.firstname + ' ' + value.lastname\n            }));\n        });\n    }).fail(function () {\n        alert('An error has occurred.');\n    });\n}\n\n/**\n * Assign users\n */\nfunction assign_users() {\n    $('#cria-assign-users').off();\n    $('#cria-assign-users').on('click', function () {\n        let role_id = $('#roleid').val();\n        // Get all selected options from cria-unassgined-users\n        var selected_users = [];\n        $('#cria-unassigned-users :selected').each(function (i, selected) {\n            var assign_users = ajax.call([{\n                methodname: 'cria_assign_user_role',\n                args: {\n                    role_id: role_id,\n                    user_id: $(selected).val()\n                }\n            }]);\n\n            assign_users[0].done(function (results) {\n            }).fail(function () {\n                alert('An error has occurred.');\n            });\n        });\n        // Set a delay, otherwise the refresh does not happen\n        setTimeout(function () {\n            get_all_users(role_id);\n        }, 500);\n        setTimeout(function () {\n            get_assigned_users(role_id);\n        }, 500);\n    });\n}\n\n/**\n * Unassign users\n */\nfunction unassign_users() {\n    $('#cria-unassign-users').off();\n    $('#cria-unassign-users').on('click', function () {\n        let role_id = $('#roleid').val();\n        // Get all selected options from cria-unassgined-users\n        var selected_users = [];\n        $('#cria-assigned-users :selected').each(function (i, selected) {\n            var unassign_users = ajax.call([{\n                methodname: 'cria_unassign_user_role',\n                args: {\n                    id: $(selected).val()\n                }\n            }]);\n\n            unassign_users[0].done(function (results) {\n            }).fail(function () {\n                alert('An error has occurred.');\n            });\n        });\n        // Set a delay, otherwise the refresh does not happen\n        setTimeout(function () {\n            get_all_users(role_id);\n        }, 500);\n        setTimeout(function () {\n            get_assigned_users(role_id);\n        }, 500);\n\n    });\n}"],"names":["get_assigned_users","role_id","empty","ajax","call","methodname","args","id","done","results","each","index","value","append","text","firstname","lastname","fail","error","console","log","alert","get_all_users","name","all_users","all_users_results","off","on","this","data","bot_id","role_name","html","val","i","selected","user_id","setTimeout","length","modal"],"mappings":"8dA8CSA,mBAAmBC,6BACtB,wBAAwBC,QACLC,cAAKC,KAAK,CAAC,CAC5BC,WAAY,0BACZC,KAAM,CACFC,GAAIN,YAIG,GAAGO,MAAK,SAAUC,yBAC3BC,KAAKD,SAAS,SAAUE,MAAOC,2BAC3B,wBAAwBC,QAAO,mBAAE,WAAY,CAC3CD,MAAOA,MAAML,GACbO,KAAMF,MAAMG,UAAY,IAAMH,MAAMI,kBAG7CC,MAAK,SAAUC,OACdC,QAAQC,IAAIF,OACZG,MAAM,sCAOLC,cAAcrB,aAASsB,4DAAO,uBACjC,0BAA0BrB,YAExBsB,UAAYrB,cAAKC,KAAK,CAAC,CACvBC,WAAY,iBACZC,KAAM,CACFL,QAASA,QACTM,IAAK,EACLgB,KAAMA,SAIdC,UAAU,GAAGhB,MAAK,SAAUiB,mCACtBf,KAAKe,mBAAmB,SAAUd,MAAOC,2BACrC,0BAA0BC,QAAO,mBAAE,WAAY,CAC7CD,MAAOA,MAAML,GACbO,KAAMF,MAAMG,UAAY,IAAMH,MAAMI,kBAG7CC,MAAK,WACJI,MAAM,2CAtFM,yBAKd,qBAAqBK,0BACrB,qBAAqBC,GAAG,SAAS,eAC3B1B,SAAU,mBAAE2B,MAAMC,KAAK,UACvBC,QAAS,mBAAEF,MAAMC,KAAK,SACtBE,WAAY,mBAAEH,MAAMC,KAAK,gCAE3B,qBAAqBG,KAAK,mBAAqBD,+BAC/C,WAAWE,IAAIhC,6BACf,UAAUgC,IAAIH,QAEhB9B,mBAAmBC,SAEnBqB,cAAcrB,6BA6EhB,sBAAsByB,0BACtB,sBAAsBC,GAAG,SAAS,eAC5B1B,SAAU,mBAAE,WAAWgC,0BAGzB,oCAAoCvB,MAAK,SAAUwB,EAAGC,UACjChC,cAAKC,KAAK,CAAC,CAC1BC,WAAY,wBACZC,KAAM,CACFL,QAASA,QACTmC,SAAS,mBAAED,UAAUF,UAIhB,GAAGzB,MAAK,SAAUC,aAC5BQ,MAAK,WACJI,MAAM,gCAIdgB,YAAW,WACPf,cAAcrB,WACf,KACHoC,YAAW,WACPrC,mBAAmBC,WACpB,4BAQL,wBAAwByB,0BACxB,wBAAwBC,GAAG,SAAS,eAC9B1B,SAAU,mBAAE,WAAWgC,0BAGzB,kCAAkCvB,MAAK,SAAUwB,EAAGC,UAC7BhC,cAAKC,KAAK,CAAC,CAC5BC,WAAY,0BACZC,KAAM,CACFC,IAAI,mBAAE4B,UAAUF,UAIT,GAAGzB,MAAK,SAAUC,aAC9BQ,MAAK,WACJI,MAAM,gCAIdgB,YAAW,WACPf,cAAcrB,WACf,KACHoC,YAAW,WACPrC,mBAAmBC,WACpB,4BAhID,gCAAgC0B,GAAG,SAAS,eACtCJ,MAAO,mBAAEK,MAAMK,MACA,GAAfV,KAAKe,QACLhB,cAAcrB,SAEdsB,KAAKe,QAAU,GACfhB,cAAcrB,QAASsB,6BAI7B,uBAAuBgB,MAAM"}